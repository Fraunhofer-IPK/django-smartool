{% extends "layouts/base.html" %}

{% block title %} Dashboard {% endblock %} 

<!-- Specific CSS goes HERE -->
{% block stylesheets %}{% endblock stylesheets %}

{% block content %}

    <!-- [ Main Content ] start -->
    <div class="pc-container">
        <div class="pcoded-content">
           <!-- [ breadcrumb ] start -->
           <div class="page-header">
            <div class="page-block">
                <div class="row align-items-center">
                    <div class="col-md-6">
                        <div class="page-header-title">
                            <h5 class="m-b-10">Dashboard SmarTool</h5>
                        </div>
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                            <li class="breadcrumb-item">Dashboard SmarTool</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        <!-- [ breadcrumb ] end -->
        <!-- [ Main Content ] start -->
        <div class="row">
            <!-- support-section start -->
            <div class="col-md-12">
                <div class="row">
                    <div class="col-md-6">
                        <div class="card support-bar overflow-hidden">
                            <div class="card-body pb-0">
                                <!-- <h2 class="m-0">131,927</h2> -->
                                <span class="text-primary">INFO</span>
                                <!-- <p class="mb-3 mt-3">Total number of manufactured parts</p> -->
                            </div>
                            <div class="card-footer border-0">
                                <div class="row text-center">
                                    <!-- <div class="col"> -->
                                        <!-- <h4 class="m-0">131,927</h4> -->
                                        <h5 class="m-0">Tool Nr:  1243598DE</h5>
                                        <h5 class="m-0">Manufactured in:  12/05/2023</h5>
                                        <h5 class="m-0">Sent to Producer in:  16/07/2023</h5>
                                        <h5 class="m-0">Time Running:  289h</h5>
                                </div>
                            </div>
                            <!-- <div id="support-chart1"></div> -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card support-bar overflow-hidden">
                            <div class="card-body pb-0">
                                <!-- <h2 class="m-0">131,927</h2> -->
                                <span class="text-primary">Manufactured Parts</span>
                                <!-- <p class="mb-3 mt-3">Total number of manufactured parts</p> -->
                            </div>
                            <div class="card-footer border-0">
                                <div class="row text-center">
                                    <div class="col">
                                        <h4 class="m-0">131,927</h4>
                                        <span>Parts produced</span>
                                    </div>
                                    <div class="col">
                                        <h4 class="m-0">31,9276</h4>
                                        <span>Parts out of tolerance</span>
                                    </div>
                                    <div class="col">
                                        <h4 class="m-0 ">100,000</h4>
                                        <span>Feasable parts</span>
                                    </div>
                                </div>
                            </div>
                            <!-- <div id="support-chart1"></div> -->
                        </div>
                    </div>
                
                    <div class="col-md-6">
                        <div class="card support-bar overflow-hidden">
                            <div class="card-body pb-0">
                                <!-- <h2 class="m-0">131,927</h2> -->
                                <span class="text-primary">Ambient Temperature</span>
                                <!-- <p class="mb-3 mt-3">Total number of manufactured parts</p> -->
                            </div>
                            <div class="card-footer border-0">
                                <div class="row text-center">
                                    <div id="data-container-2" class="m-0">
                                        <!-- Data will be displayed here -->
                                        <script>
                                            let timerId_2 = null; // Variable to store the timer ID                                                
                                            function fetchData_2() {
                                                fetch('/api/arduino-results/') // Replace with your Django API endpoint
                                                    .then(response => response.json()) // Convert the response to JSON format
                                                    .then(data => {
                                                        // Display the last item from the data array
                                                        const lastItem = data[data.length - 1];
                                                        const formattedItem =   `<p style="font-size: 20px;"><strong>Last measured value:</strong> ${lastItem.mean_ambient_temperature} 째C</p>
                                                                                <p style="font-size: 20px;"><strong>Mean value:</strong> ${lastItem.mean_ambient_temperature} 째C</p>`;
                                                        document.getElementById('data-container-2').innerHTML = formattedItem;
                                                    })
                                                    .catch(error => console.error('Error fetching data:', error)); // Handle errors if fetch fails
                                            }
                                        
                                            // Fetch data initially
                                            fetchData_2();
                                        
                                            // Fetch data and display every 1 seconds (for example)
                                            setInterval(() => {
                                                fetchData_2(); // Fetch data from the API
                                            }, 1000); // Set interval to fetch data every 1 second (1000 milliseconds)
                                        </script>
                                       
                                    </div>
                                    <!-- <div class="col">
                                        <h4 class="m-0">38.23째C</h4>
                                        <span>Last measured value</span>
                                    </div>
                                    <div class="col">
                                        <h4 class="m-0">38,76째C</h4>
                                        <span>Mean value</span>
                                    </div> -->
                                </div>
                            </div>
                            <!-- <div id="support-chart1"></div> -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card support-bar overflow-hidden">
                            <div class="card-body pb-0">
                                <!-- <h2 class="m-0">131,927</h2> -->
                                <span class="text-primary">Ambient Humidity</span>
                                <!-- <p class="mb-3 mt-3">Total number of manufactured parts</p> -->
                            </div>
                            <div class="card-footer border-0">
                                <div class="row text-center">
                                    <div id="data-container-3" class="m-0">
                                        <!-- Data will be displayed here -->
                                        <script>
                                            let timerId_3 = null; // Variable to store the timer ID                                                
                                            function fetchData_3() {
                                                fetch('/api/arduino-results/') // Replace with your Django API endpoint
                                                    .then(response => response.json()) // Convert the response to JSON format
                                                    .then(data => {
                                                        // Display the last item from the data array
                                                        const lastItem = data[data.length - 1];
                                                        const formattedItem =   `<p style="font-size: 20px;"><strong>Last measured value:</strong> ${lastItem.mean_ambient_humidity} %</p>
                                                                                <p style="font-size: 20px;"><strong>Mean value:</strong> ${lastItem.mean_ambient_humidity} %</p>`;
                                                        document.getElementById('data-container-3').innerHTML = formattedItem;
                                                    })
                                                    .catch(error => console.error('Error fetching data:', error)); // Handle errors if fetch fails
                                            }
                                        
                                            // Fetch data initially
                                            fetchData_3();
                                        
                                            // Fetch data and display every 1 seconds (for example)
                                            setInterval(() => {
                                                fetchData_3(); // Fetch data from the API
                                            }, 1000); // Set interval to fetch data every 1 second (1000 milliseconds)
                                        </script>
                                       
                                    </div>
                                    <!-- <div class="col">
                                        <h4 class="m-0">38.23%</h4>
                                        <span>Last measured value</span> 
                                    </div>
                                    <div class="col">
                                        <h4 class="m-0">38,76%</h4>
                                        <span>Mean value</span>
                                    </div> -->
                                </div>
                            </div>
                            <!-- <div id="support-chart1"></div> -->
                        </div>
                    </div>
                
                    <div class="col-md-6">
                        <div class="card support-bar overflow-hidden">
                            <div class="card-body pb-0">
                                <!-- <h2 class="m-0">131,927</h2> -->
                                <span class="text-primary">Cavity Temperature</span>
                                <!-- <p class="mb-3 mt-3">Total number of manufactured parts</p> -->
                            </div>
                            <div class="card-footer border-0">
                                <div class="row text-center">
                                    <div id="data-container-4" class="m-0">
                                        <!-- Data will be displayed here -->
                                        <script>
                                            let timerId_4 = null; // Variable to store the timer ID                                                
                                            function fetchData_4() {
                                                fetch('/api/arduino-results/') // Replace with your Django API endpoint
                                                    .then(response => response.json()) // Convert the response to JSON format
                                                    .then(data => {
                                                        // Display the last item from the data array
                                                        const lastItem = data[data.length - 1];
                                                        const formattedItem =   `<p style="font-size: 20px;"><strong>Last measured value:</strong> ${lastItem.mean_cavity_temperature} 째C</p>
                                                                                <p style="font-size: 20px;"><strong>Mean value:</strong> ${lastItem.mean_cavity_temperature} 째C</p>
                                                                                <p style="font-size: 20px;"><strong>Set value in machine:</strong> 110 째C</p>`;
                                                        document.getElementById('data-container-4').innerHTML = formattedItem;
                                                    })
                                                    .catch(error => console.error('Error fetching data:', error)); // Handle errors if fetch fails
                                            }
                                        
                                            // Fetch data initially
                                            fetchData_4();
                                        
                                            // Fetch data and display every 1 seconds (for example)
                                            setInterval(() => {
                                                fetchData_4(); // Fetch data from the API
                                            }, 1000); // Set interval to fetch data every 1 second (1000 milliseconds)
                                        </script>
                                       
                                    </div>
                                    <!-- <div class="col">
                                        <h4 class="m-0">105.12째C</h4>
                                        <span>Last measured value</span>
                                    </div>
                                    <div class="col">
                                        <h4 class="m-0">107.54째C</h4>
                                        <span>Mean value</span>
                                    </div>
                                    <div class="col">
                                        <h4 class="m-0">110째C</h4>
                                        <span>Set value in machine</span>
                                    </div> -->
                                </div>
                            </div>
                            <!-- <div id="support-chart1"></div> -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card support-bar overflow-hidden">
                            <div class="card-body pb-0">
                                <!-- <h2 class="m-0">131,927</h2> -->
                                <span class="text-primary">Clampling Force</span>
                                <!-- <p class="mb-3 mt-3">Total number of manufactured parts</p> -->
                            </div>
                            <div class="card-footer border-0">
                                <div class="row text-center">
                                    <div id="data-container-6" class="m-0">
                                        <script>
                                            let timerId_6 = null; // Variable to store the timer ID                                                
                                            function fetchData_6() {
                                                fetch('/api/arduino-results/') // Replace with your Django API endpoint
                                                    .then(response => response.json()) // Convert the response to JSON format
                                                    .then(data => {
                                                        // Display the last item from the data array
                                                        const lastItem = data[data.length - 1];
                                                        // Create a formatted string to display data
                                                        const formattedItem =   `<p style="font-size: 20px;"><strong>Last measured value:</strong> ${formatNumber(lastItem.mean_closing_force)} kN</p> 
                                                                                <p style="font-size: 20px;"><strong>Mean value:</strong> ${formatNumber(lastItem.mean_closing_force)} kN</p>
                                                                                <p style="font-size: 20px;"><strong>Set value in machine:</strong> 500 kN</p>`;
                                                        // const formattedItem = `<p style="font-size: 20px;"><strong>Last measured value:</strong> ${lastItem.mean_closing_force} <strong>Mean value:</strong> ${lastItem.mean_closing_force}</p>`;
                                                        // Update the HTML content 
                                                        document.getElementById('data-container-6').innerHTML = formattedItem;
                                                    })
                                                    .catch(error => console.error('Error fetching data:', error)); // Handle errors if fetch fails
                                            }
                                            function formatNumber(number) {
                                                // Use toLocaleString to format the number with dots for thousands
                                                return number.toLocaleString();
                                            }
                                            // Fetch data initially
                                            fetchData_6();
                                        
                                            // Fetch data and display every 1 seconds (for example)
                                            setInterval(() => {
                                                fetchData_6(); // Fetch data from the API
                                            }, 1000); // Set interval to fetch data every 1 second (1000 milliseconds)
                                        </script>
                                    </div>
                                    <!-- <div class="col">
                                        <h4 class="m-0">411 kN</h4>
                                        <span>Last measured value</span>
                                    </div>
                                    <div class="col">
                                        <h4 class="m-0">482 kN</h4>
                                        <span>Mean value</span>
                                    </div>
                                    <div class="col">
                                        <h4 class="m-0">500 kN</h4>
                                        <span>Set value in machine</span>
                                    </div> -->
                                </div>
                            </div>
                            <!-- <div id="support-chart1"></div> -->
                        </div>
                    </div>
                
                    <div class="col-md-6">
                        <div class="card support-bar overflow-hidden">
                            <div class="card-body pb-0">
                                <!-- <h2 class="m-0">131,927</h2> -->
                                <span class="text-primary">Cavity Pressure</span>
                                <!-- <p class="mb-3 mt-3">Total number of manufactured parts</p> -->
                            </div>
                            <div class="card-footer border-0">
                                <div class="row text-center">
                                    <div id="data-container-5" class="m-0">
                                        <script>
                                            let timerId_5 = null; // Variable to store the timer ID                                                
                                            function fetchData_5() {
                                                fetch('/api/arduino-results/') // Replace with your Django API endpoint
                                                    .then(response => response.json()) // Convert the response to JSON format
                                                    .then(data => {
                                                        // Display the last item from the data array
                                                        const lastItem = data[data.length - 1];
                                                        const formattedItem =   `<p style="font-size: 20px;"><strong>Last measured value:</strong> ${formatNumber(lastItem.mean_cavity_pressure)} Bar</p>
                                                                                <p style="font-size: 20px;"><strong>Mean value:</strong> ${formatNumber(lastItem.mean_cavity_pressure)} Bar</p>
                                                                                <p style="font-size: 20px;"><strong>Set value in machine:</strong> 1000 Bar`;
                                                        //const formattedItem = `<p style="font-size: 20px;"><strong>Last measured value:</strong> ${lastItem.mean_cavity_pressure} <strong>Mean value:</strong> ${lastItem.mean_cavity_pressure}</p>`;
                                                        document.getElementById('data-container-5').innerHTML = formattedItem;
                                                    })
                                                    .catch(error => console.error('Error fetching data:', error)); // Handle errors if fetch fails
                                            }
                                            function formatNumber(number) {
                                                // Use toLocaleString to format the number with dots for thousands
                                                return number.toLocaleString();
                                            }
                                        
                                            // Fetch data initially
                                            fetchData_5();
                                        
                                            // Fetch data and display every 1 seconds (for example)
                                            setInterval(() => {
                                                fetchData_5(); // Fetch data from the API
                                            }, 1000); // Set interval to fetch data every 1 second (1000 milliseconds)
                                        </script>
                                    </div>
                                    <!-- <div class="col">
                                        <h4 class="m-0">993 Bar</h4>
                                        <span>Last measured value</span>
                                    </div>
                                    <div class="col">
                                        <h4 class="m-0">961 Bar</h4>
                                        <span>Mean value</span>
                                    </div>
                                    <div class="col">
                                        <h4 class="m-0">1000 Bar</h4>
                                        <span>Set value in machine</span>
                                    </div> -->
                                </div>
                            </div>
                            <!-- <div id="support-chart1"></div> -->
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card support-bar overflow-hidden">
                            <div class="card-body pb-0">
                                <!-- <h2 class="m-0">131,927</h2> -->
                                <span class="text-primary">Cycles until Overhaul</span>
                                <!-- <p class="mb-3 mt-3">Total number of manufactured parts</p> -->
                            </div>
                            <div class="card-footer border-0">
                                <div class="row text-center">
                                    <div id="data-container" class="m-0">
                                        <!-- Data will be displayed here -->
                                        <script>
                                            let timerId = null; // Variable to store the timer ID
                                        
                                            function fetchData() {
                                                fetch('/api/arduino-results/') // Replace with your Django API endpoint
                                                    .then(response => response.json()) // Convert the response to JSON format
                                                    .then(data => {
                                                        // Display the last item from the data array
                                                        const lastItem = data[data.length - 1];
                                                        const formattedItem = `<p style="font-size: 20px;"><strong> Number:</strong> ${formatNumber(lastItem.cycle_nr)}/200,000</p>`;
                                                        //const formattedItem = `<p style="font-size: 20px;"><strong> Number: </strong>${lastItem.cycle_nr}</p>`;
                                                        document.getElementById('data-container').innerHTML = formattedItem;
                                                    })
                                                    .catch(error => console.error('Error fetching data:', error)); // Handle errors if fetch fails
                                            }
                                            function formatNumber(number) {
                                                // Use toLocaleString to format the number with dots for thousands
                                                return number.toLocaleString();
                                            }
                                        
                                            // Fetch data initially
                                            fetchData();
                                        
                                            // Fetch data and display every 1 seconds (for example)
                                            setInterval(() => {
                                                fetchData(); // Fetch data from the API
                                            }, 1000); // Set interval to fetch data every 1 second (1000 milliseconds)
                                        </script>
                                       
                                    </div>
                                </div>
                            </div>
                            
                            <!-- <div class="card-footer border-0">
                                <div class="row text-center">
                                    <div class="col">
                                         <h4 class="m-0"> item.cycle_nr </h4>
                                        <span>Cycles until overhaul</span> 
                                        {% for item in data %}
                                        <div class="card">
                                            <h3>ID: {{ item.ID }}</h3>
                                            <p>Cycle Number: {{ item.cycle_nr }}</p>
                                        </div>
                                        {% endfor %}
                                        {% if data %}
                                            <p>Data exists!</p>
                                        {% else %}
                                            <p>No data available.</p>
                                        {% endif %}
                                    </div>
                                    
                                </div>
                            </div> 
                            <div id="support-chart1"></div> -->
                        </div>
                    </div>          
                
                    <div class="col-xl-6 col-md-12">
                        <div class="card support-bar overflow-hidden">
                            <div class="card-body pb-0">
                                <!-- <h2 class="m-0">131,927</h2> -->
                                <span class="text-primary">Location</span>
                                
                                <!-- <p class="mb-3 mt-3">Total number of manufactured parts</p> -->
                            </div>
                            <div class="card-footer border-0">
                                <div class="row text-center">
                                    <div class="col">
                                        <div style="position:relative; padding-bottom:75%; height:0; overflow:hidden; padding-right: 100%;">
                                            <iframe
                                                src="https://www.openstreetmap.org/export/embed.html?bbox={{ box_lng_left }}%2C{{ box_lat_bottom }}%2C{{ box_lng_right}}%2C{{box_lat_top}}&amp;layer=mapnik&marker={{ lat }}%2C{{ lng }}"
                                                style="position:absolute; width:100%; height:100%; border: 1px solid rgb(255, 255, 255);"
                                                allowfullscreen>
                                            </iframe>
                                        </div>
                                        <br />
                                        <small><a href="https://www.openstreetmap.org/#map=19/52.52375/13.32361">View Larger Map</a></small>
                                    </div>
                                </div>
                            </div>
                            <!-- <div id="support-chart1"></div> -->
                        </div>
                    </div>
                </div>
            </div>
            <!-- customer-section end -->
        </div>
        <!-- [ Main Content ] end -->
    </div>
</div>
<!-- [ Main Content ] end -->

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

    <script src="/static/assets/js/plugins/apexcharts.min.js"></script>
    <script src="/static/assets/js/pages/dashboard-sale.js"></script>

{% endblock javascripts %}
